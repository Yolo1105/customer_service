{{ define "users_list.html" }}
<style>
  .unread-badge {
    background: #f44336;
    color: white;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: auto;
    font-size: 0.8rem;
  }

  .notifications-container {
    display: none;
  }

  .user-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .user-item {
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
  }

  .user-item:hover {
    background-color: #e8e8e8;
  }

  .user-item.active {
    background-color: var(--primary-color);
    color: white;
  }

  .user-item.active .user-pic {
    border-color: white;
  }

  .user-pic {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    margin-right: 0.75rem;
    border: 2px solid #ddd;
  }

  .user-status {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-left: auto;
    background-color: #4caf50;
  }

  .self-section {
    padding: 1rem;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 1rem;
  }
  .self-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
</style>

<div class="online-users">
  {{ if .Self }}
  <div class="self-section">
    <h4>Me</h4>
    <div class="self-item">
      <img
        class="user-pic"
        src="{{ (index .Self 0).picture }}"
        alt="{{ (index .Self 0).name }}"
      />
      <span>{{ (index .Self 0).name }}</span>
    </div>
  </div>
  {{ end }}

  <h4>Online Users</h4>
  <ul class="user-list">
    {{ range .Others }}
    <li
      class="user-item"
      data-id="{{ .id }}"
      onclick="selectUser('{{ .id }}', '{{ .name }}')"
    >
      <img class="user-pic" src="{{ .picture }}" alt="{{ .name }}" />
      <span>{{ .name }}</span>
      <div class="unread-badge" data-user="{{ .id }}"></div>
    </li>
    {{ end }}
  </ul>
</div>

<script>
  // Fetch the user list and display names
  document.addEventListener("DOMContentLoaded", function () {
    fetch("/users")
      .then((response) => response.json())
      .then((users) => {
        const userList = document.getElementById("user-list");
        userList.innerHTML = ""; // Clear any existing content
        users.forEach((user) => {
          const li = document.createElement("li");
          li.textContent = user.name;
          li.className = "user-item";
          li.dataset.id = user.id;
          li.onclick = () => selectUser(user.id, user.name);
          userList.appendChild(li);
        });
      });
  });

  // WebSocket for user-list updates
  const userListSocket = new WebSocket("ws://" + window.location.host + "/ws");
  userListSocket.addEventListener("message", function (event) {
    if (event.data === "users-update") {
      // Reload the user list
      fetch("/users")
        .then((response) => response.json())
        .then((users) => {
          const userList = document.getElementById("user-list");
          userList.innerHTML = "";
          users.forEach((user) => {
            const li = document.createElement("li");
            li.textContent = user.name;
            li.className = "user-item";
            li.dataset.id = user.id;
            li.onclick = () => selectUser(user.id, user.name);
            userList.appendChild(li);
          });
        });
    }
  });
</script>
{{ end }}
